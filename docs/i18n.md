# Internationalization (i18n)

Type-safe translations using `next-intl` with cookie-based locale sync across Multi-Zone apps.

## Quick Start

```tsx
import { getTranslations, dashboard } from '@stackone/i18n'

export default async function Page() {
  const t = await getTranslations()
  return <h1>{t(dashboard.title)}</h1>
}
```

## Supported Languages

| Code | Name | Status |
|------|------|--------|
| `en` | English | Default |
| `fr` | Français | Supported |

## Locale Detection

Locale is synced across Shell and MFEs via cookie:

1. User changes language in Shell header
2. Cookie set: `NEXT_LOCALE=fr`
3. MFE reads cookie via `i18n/request.ts`
4. Both apps render in same language

## Usage Patterns

### Server Components

```tsx
import { getTranslations, dashboard, aria } from '@stackone/i18n'

const t = await getTranslations()
<h1>{t(dashboard.title)}</h1>
<input aria-label={t(aria.search)} />
```

### Client Components

```tsx
'use client'
import { useTranslations } from 'next-intl'
import { labels } from '@stackone/i18n'

const t = useTranslations()
<span>{t(labels.loading)}</span>
```

### Dynamic Values

```json
{
  "logDetail": {
    "breadcrumbLog": "Log {id}",
    "spans": "{count} spans"
  }
}
```

```tsx
t(logDetail.breadcrumbLog, { id: '123' })  // "Log 123"
```

## Key Namespaces

```tsx
import {
  getTranslations,   // Translation function
  dashboard,         // Dashboard page
  logs, logDetail,   // Log pages
  search, explore,   // Other pages
  metadata, sidebar, // Layout
  aria,              // ARIA labels
  navigation,        // Nav items
  logLevels,         // All, Error, Warning, Info, Debug
  timeRanges,        // Last 24h, 7d, 30d, Custom
} from '@stackone/i18n'
```

## Adding Translations

### 1. Add to JSON files

```json
// messages/en/shell.json
{
  "newFeature": {
    "title": "New Feature"
  }
}

// messages/fr/shell.json
{
  "newFeature": {
    "title": "Nouvelle fonctionnalité"
  }
}
```

### 2. Add typed key

```typescript
// src/keys.ts
export const newFeature = {
  title: 'newFeature.title',
} as const
```

### 3. Export from index

```typescript
// src/index.ts
export { newFeature } from './keys'
```

### 4. Use in component

```tsx
import { getTranslations, newFeature } from '@stackone/i18n'

const t = await getTranslations()
t(newFeature.title)
```

## Service Worker Caching

Translation JSON files are cached cache-first:

```javascript
const TRANSLATION_PATTERN = /\/(en|fr)\/(common|shell|agent-toolkit)\.json$/
```

## File Structure

```
packages/i18n/
├── messages/
│   ├── en/
│   │   ├── common.json      # Shared: navigation, aria, labels
│   │   ├── shell.json       # Shell app
│   │   └── agent-toolkit.json
│   └── fr/
│       └── ...
└── src/
    ├── config.ts            # Locales, cookie name
    ├── keys.ts              # Typed translation keys
    ├── messages.ts          # Message loaders
    └── index.ts             # Exports
```

## Configuration

```typescript
// src/config.ts
export const locales = ['en', 'fr'] as const
export const defaultLocale = 'en'
export const LOCALE_COOKIE = 'NEXT_LOCALE'
```
