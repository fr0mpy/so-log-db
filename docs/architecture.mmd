flowchart TB
    subgraph Design["DESIGN LAYER"]
        TOKENS[Design Tokens<br/>Tokens Studio + Style Dictionary]
    end

    subgraph Packages["SHARED PACKAGES"]
        UI[Component Library<br/>Tailwind + Tokens]
        THEME[Theme Provider]
        SYNC[PowerSync Client]
    end

    subgraph App["NEXT.JS APP"]
        LAYOUT[Root Layout] --> PROVIDERS[Providers]
        PROVIDERS --> ROUTES[Route Segments<br/>logs / analytics / settings]
    end

    subgraph Client["BROWSER RUNTIME"]
        PS[PowerSync] <--> SQLITE[(SQLite)]
    end

    subgraph Services["BACKEND SERVICES"]
        CDN[Theme CDN]
        PS_SVC[PowerSync Service]
        API[REST API]
        DB[(Postgres)]
    end

    subgraph Ops["OBSERVABILITY"]
        OTEL[OpenTelemetry] --> COLLECTOR[Collector]
        SENTRY[Sentry]
    end

    %% Build-time dependencies
    TOKENS --> UI
    TOKENS --> THEME
    UI --> App
    THEME --> PROVIDERS
    SYNC --> PROVIDERS

    %% Runtime connections
    CDN -.->|fetch config| PROVIDERS
    ROUTES <--> PS
    PS <-->|sync| PS_SVC
    PS_SVC <--> DB
    API -->|write logs| DB

    %% Observability
    App -.-> OTEL
    App -.-> SENTRY
